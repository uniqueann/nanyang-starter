import{D as t,Q as e,O as a,C as i,g as s,u as l,o,c as n,w as d,i as r,b as c,k as u,t as _,e as f,F as m,l as h,j as p,m as g,p as w,V as b}from"./index-0982dc28.js";import{_ as D}from"./uni-dateformat.cb07646a.js";import{r as y}from"./uni-app.es.0abf17f1.js";import{_ as x,a as j}from"./uni-list.41a88308.js";import{_ as k}from"./unicloud-db.9e3e3341.js";import{_ as v}from"./_plugin-vue_export-helper.1b428a4d.js";import"./uni-icons.3b963afa.js";const L=t.database().collection("read-news-log");const $=v({data:()=>({id:"",title:"title",field:"user_id.nickname,user_id._id,avatar,excerpt,last_modify_date,comment_count,like_count,title,content",formData:{noData:'<p style="text-align:center;color:#666">详情加载中...</p>'}}),computed:{uniStarterConfig:()=>e().globalData.config,where(){return`_id =="${this.id}"`}},onLoad(t){t.id&&(this.id=t.id),t.title&&(this.title=t.title,a({title:t.title}))},onReady(){this.id?this.$refs.detail.loadData():i({icon:"none",title:this.$t("listDetail.newsErr")})},onNavigationBarButtonTap(t){"share"==t.type&&this.shareClick()},methods:{$log(...t){console.log("args",...t,this.id)},setReadNewsLog(){let t={article_id:this.id,last_time:Date.now()},e=s("readNewsLog")||[],a=-1;e.forEach((({article_id:e},i)=>{e==t.article_id&&(a=i)})),-1===a?e.push(t):e.splice(a,1,t),l("readNewsLog",e),console.log(e)},setFavorite(){if(t.getCurrentUserInfo().tokenExpired<Date.now())return console.log("未登录用户");let e=this.id,a=Date.now();console.log({article_id:e,last_time:a}),L.where(`"article_id" == "${e}" && "user_id"==$env.uid`).update({last_time:a}).then((({result:{updated:t}})=>{console.log("updated",t),t||L.add({article_id:e}).then((t=>{console.log(t)})).catch((t=>{console.log(t)}))})).catch((t=>{console.log(t)}))},loadData(t){""==this.title&&t[0].title&&(this.title=t[0].title,a({title:t[0].title})),this.setReadNewsLog()},followClick(){i({title:this.$t("listDetail.follow"),icon:"none"})}}},[["render",function(t,e,a,i,s,l){const v=r,L=y(p("uni-dateformat"),D),$=y(p("uni-list-item"),x),C=y(p("uni-list"),j),N=g,E=w,F=b,R=y(p("unicloud-db"),k);return o(),n(v,{class:"article"},{default:d((()=>[c(v,{class:"article-title"},{default:d((()=>[u(_(s.title),1)])),_:1}),c(R,{options:s.formData,collection:"opendb-news-articles,uni-id-users",field:s.field,getone:!0,where:l.where,manual:!0,ref:"detail",foreignKey:"opendb-news-articles.user_id",onLoad:l.loadData},{default:d((({data:t,loading:e,error:a,options:i})=>[!e&&t?(o(),f(m,{key:0},[c(C,{border:!1},{default:d((()=>[c($,{thumbSize:"lg",thumb:t.image},{body:d((()=>[c(v,{class:"header-content"},{default:d((()=>[c(v,{class:"uni-title"},{default:d((()=>[u(_(t.user_id&&t.user_id[0]&&t.user_id[0].nickname||"未知"),1)])),_:2},1024)])),_:2},1024)])),footer:d((()=>[c(v,{class:"footer"},{default:d((()=>[c(v,{class:"uni-note"},{default:d((()=>[u("更新于 "),c(L,{date:t.last_modify_date,format:"yyyy-MM-dd hh:mm",threshold:[6e4,2592e6]},null,8,["date"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["thumb"])])),_:2},1024),c(v,{class:"banner"},{default:d((()=>[c(N,{class:"banner-img",src:t.avatar,mode:"widthFix"},null,8,["src"]),c(v,{class:"banner-title"},{default:d((()=>[c(E,{class:"uni-ellipsis"},{default:d((()=>[u(_(t.excerpt),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),c(v,{class:"article-content"},{default:d((()=>[c(F,{nodes:t.content},null,8,["nodes"])])),_:2},1024)],64)):h("",!0)])),_:1},8,["options","field","where","onLoad"])])),_:1})}],["__scopeId","data-v-e431da13"]]);export{$ as default};
