import{E as e,a5 as t,a3 as a,R as i,g as s,V as l,o,c as d,w as n,i as r,b as c,k as u,t as f,e as _,F as m,l as h,j as p,m as g,p as b,a9 as w}from"./index.a6ab672a.js";import{_ as y}from"./uni-dateformat.3c851a38.js";import{r as D}from"./uni-app.es.99d2207b.js";import{_ as j,a as k}from"./uni-list.3f3504b4.js";import{_ as x}from"./unicloud-db.1f2c81de.js";import{_ as v}from"./_plugin-vue_export-helper.cdc0426e.js";import"./uni-icons.ebd9f8fe.js";const L=e.database().collection("read-news-log");const $=v({data:()=>({id:"",title:"title",field:"user_id.nickname,user_id._id,avatar,excerpt,last_modify_date,comment_count,like_count,title,content",formData:{noData:'<p style="text-align:center;color:#666">详情加载中...</p>'}}),computed:{uniStarterConfig:()=>t().globalData.config,where(){return`_id =="${this.id}"`}},onLoad(e){e.id&&(this.id=e.id),e.title&&(this.title=e.title,a({title:e.title}))},onReady(){this.id?this.$refs.detail.loadData():i({icon:"none",title:this.$t("listDetail.newsErr")})},onNavigationBarButtonTap(e){"share"==e.type&&this.shareClick()},methods:{$log(...e){console.log("args",...e,this.id)},setReadNewsLog(){let e={article_id:this.id,last_time:Date.now()},t=s("readNewsLog")||[],a=-1;t.forEach((({article_id:t},i)=>{t==e.article_id&&(a=i)})),-1===a?t.push(e):t.splice(a,1,e),l("readNewsLog",t),console.log(t)},setFavorite(){if(e.getCurrentUserInfo().tokenExpired<Date.now())return console.log("未登录用户");let t=this.id,a=Date.now();console.log({article_id:t,last_time:a}),L.where(`"article_id" == "${t}" && "user_id"==$env.uid`).update({last_time:a}).then((({result:{updated:e}})=>{console.log("updated",e),e||L.add({article_id:t}).then((e=>{console.log(e)})).catch((e=>{console.log(e)}))})).catch((e=>{console.log(e)}))},loadData(e){""==this.title&&e[0].title&&(this.title=e[0].title,a({title:e[0].title})),this.setReadNewsLog()},followClick(){i({title:this.$t("listDetail.follow"),icon:"none"})}}},[["render",function(e,t,a,i,s,l){const v=r,L=D(p("uni-dateformat"),y),$=D(p("uni-list-item"),j),N=D(p("uni-list"),k),C=g,E=b,R=w,F=D(p("unicloud-db"),x);return o(),d(v,{class:"article"},{default:n((()=>[c(v,{class:"article-title"},{default:n((()=>[u(f(s.title),1)])),_:1}),c(F,{options:s.formData,collection:"opendb-news-articles,uni-id-users",field:s.field,getone:!0,where:l.where,manual:!0,ref:"detail",foreignKey:"opendb-news-articles.user_id",onLoad:l.loadData},{default:n((({data:e,loading:t,error:a,options:i})=>[!t&&e?(o(),_(m,{key:0},[c(N,{border:!1},{default:n((()=>[c($,{thumbSize:"lg",thumb:e.image},{body:n((()=>[c(v,{class:"header-content"},{default:n((()=>[c(v,{class:"uni-title"},{default:n((()=>[u(f(e.user_id&&e.user_id[0]&&e.user_id[0].nickname||"未知"),1)])),_:2},1024)])),_:2},1024)])),footer:n((()=>[c(v,{class:"footer"},{default:n((()=>[c(v,{class:"uni-note"},{default:n((()=>[u("更新于 "),c(L,{date:e.last_modify_date,format:"yyyy-MM-dd hh:mm",threshold:[6e4,2592e6]},null,8,["date"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["thumb"])])),_:2},1024),c(v,{class:"banner"},{default:n((()=>[c(C,{class:"banner-img",src:e.avatar,mode:"widthFix"},null,8,["src"]),c(v,{class:"banner-title"},{default:n((()=>[c(E,{class:"uni-ellipsis"},{default:n((()=>[u(f(e.excerpt),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),c(v,{class:"article-content"},{default:n((()=>[c(R,{nodes:e.content},null,8,["nodes"])])),_:2},1024)],64)):h("",!0)])),_:1},8,["options","field","where","onLoad"])])),_:1})}],["__scopeId","data-v-9a0df2be"]]);export{$ as default};
