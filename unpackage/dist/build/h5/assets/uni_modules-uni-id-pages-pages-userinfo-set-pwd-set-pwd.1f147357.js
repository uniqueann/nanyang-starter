import{E as s,ad as e,R as o,S as a,o as t,c as r,w as i,i as n,b as l,k as d,l as u,m as c,p,j as m,X as f}from"./index.a6ab672a.js";import{_ as w}from"./uni-match-media.d886e44e.js";import{r as h}from"./uni-app.es.99d2207b.js";import{_ as b}from"./uni-easyinput.2ba0c49e.js";import{_}from"./uni-forms-item.2c8460c5.js";import{_ as g}from"./uni-id-pages-sms-form.59664890.js";import{_ as P}from"./uni-forms.91c5073b.js";import{_ as y}from"./uni-popup-captcha.85eacf52.js";import{p as j}from"./password.71ef6bb8.js";import{s as k,m as D}from"./store.9e013368.js";import{_ as C}from"./_plugin-vue_export-helper.cdc0426e.js";import"./uni-icons.ebd9f8fe.js";import"./uni-captcha.1d2e166c.js";import"./uni-popup.358ae8aa.js";const I=s.importObject("uni-id-co",{customUI:!0});const V=C({name:"set-pwd.vue",data:()=>({uniIdRedirectUrl:"",loginType:"",logo:"/static/logo.png",focusNewPassword:!1,focusNewPassword2:!1,allowSkip:!1,formData:{code:"",captcha:"",newPassword:"",newPassword2:""},rules:j.getPwdRules("newPassword","newPassword2")}),computed:{userInfo:()=>k.userInfo},onReady(){this.$refs.form.setRules(this.rules)},onLoad(s){var o;this.uniIdRedirectUrl=s.uniIdRedirectUrl,this.loginType=s.loginType,e.setPasswordAfterLogin&&(null==(o=e.setPasswordAfterLogin)?void 0:o.allowSkip)&&(this.allowSkip=!0)},methods:{submit(){if(!/^\d{6}$/.test(this.formData.code))return this.$refs.smsCode.focusSmsCodeInput=!0,o({title:"验证码格式不正确",icon:"none"});this.$refs.form.validate().then((s=>{I.setPwd({password:this.formData.newPassword,code:this.formData.code,captcha:this.formData.captcha}).then((s=>{a({content:"密码设置成功",showCancel:!1,success:()=>{D.loginBack({uniIdRedirectUrl:this.uniIdRedirectUrl,loginType:this.loginType})}})})).catch((s=>{a({content:s.message,showCancel:!1})}))})).catch((s=>{"uni-id-captcha-required"==s.errCode?this.$refs.popup.open():console.log(s.errMsg)})).finally((s=>{this.formData.captcha=""}))},skip(){D.loginBack(this.uniIdRedirectUrl)}}},[["render",function(s,e,o,a,j,k){const D=c,C=n,I=p,V=h(m("uni-match-media"),w),U=h(m("uni-easyinput"),b),R=h(m("uni-forms-item"),_),v=h(m("uni-id-pages-sms-form"),g),x=f,B=h(m("uni-forms"),P),N=h(m("uni-popup-captcha"),y);return t(),r(C,{class:"uni-content"},{default:i((()=>[l(V,{"min-width":690},{default:i((()=>[l(C,{class:"login-logo"},{default:i((()=>[l(D,{src:j.logo},null,8,["src"])])),_:1}),l(I,{class:"title title-box"},{default:i((()=>[d("设置密码")])),_:1})])),_:1}),l(B,{class:"set-password-form",ref:"form",value:j.formData,"err-show-type":"toast"},{default:i((()=>[l(I,{class:"tip"},{default:i((()=>[d("输入密码")])),_:1}),l(R,{name:"newPassword"},{default:i((()=>[l(U,{focus:j.focusNewPassword,onBlur:e[0]||(e[0]=s=>j.focusNewPassword=!1),class:"input-box",type:"password",inputBorder:!1,modelValue:j.formData.newPassword,"onUpdate:modelValue":e[1]||(e[1]=s=>j.formData.newPassword=s),placeholder:"请输入密码"},null,8,["focus","modelValue"])])),_:1}),l(I,{class:"tip"},{default:i((()=>[d("再次输入密码")])),_:1}),l(R,{name:"newPassword2"},{default:i((()=>[l(U,{focus:j.focusNewPassword2,onBlur:e[2]||(e[2]=s=>j.focusNewPassword2=!1),class:"input-box",type:"password",inputBorder:!1,modelValue:j.formData.newPassword2,"onUpdate:modelValue":e[3]||(e[3]=s=>j.formData.newPassword2=s),placeholder:"请再次输入新密码"},null,8,["focus","modelValue"])])),_:1}),l(v,{modelValue:j.formData.code,"onUpdate:modelValue":e[4]||(e[4]=s=>j.formData.code=s),type:"set-pwd-by-sms",ref:"smsCode",phone:k.userInfo.mobile},null,8,["modelValue","phone"]),l(C,{class:"link-box"},{default:i((()=>[l(x,{class:"uni-btn send-btn",type:"primary",onClick:k.submit},{default:i((()=>[d("确认")])),_:1},8,["onClick"]),j.allowSkip?(t(),r(x,{key:0,class:"uni-btn send-btn",type:"default",onClick:k.skip},{default:i((()=>[d("跳过")])),_:1},8,["onClick"])):u("",!0)])),_:1})])),_:1},8,["value"]),l(N,{onConfirm:k.submit,modelValue:j.formData.captcha,"onUpdate:modelValue":e[5]||(e[5]=s=>j.formData.captcha=s),scene:"set-pwd-by-sms",ref:"popup"},null,8,["onConfirm","modelValue"])])),_:1})}],["__scopeId","data-v-48ed0c26"]]);export{V as default};
