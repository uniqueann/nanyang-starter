"use strict";const e=require("../../../common/vendor.js"),t="__local_search_history";const s={data:()=>({mallGoodsDbName:"opendb-news-articles",searchLogDbName:"opendb-search-log",statusBarHeight:"0px",localSearchList:e.index.getStorageSync(t),localSearchListDel:!1,netHotListIsHide:!1,searchText:"",iconColor:"#999999",associativeList:[],keyBoardPopup:!1,hotWorld:"DCloud",focus:!0,speechEngine:"iFly"}),created(){this.db=e.Ds.database(),this.searchLogDb=this.db.collection(this.searchLogDbName),this.mallGoodsDb=this.db.collection(this.mallGoodsDbName),e.index.onKeyboardHeightChange((e=>{this.keyBoardPopup=0!==e.height})),this.searchText=getApp().globalData.searchText},computed:{associativeShow(){return this.searchText&&this.associativeList.length}},onLoad(){},methods:{clear(e){console.log("res: ",e)},confirm(e){this.search(e.value)},cancel(t){e.index.hideKeyboard(),this.searchText="",this.loadList()},search(t){(t||this.hotWorld)&&(t?(this.searchText!==t&&(this.searchText=t),this.localSearchListManage(t),this.searchLogDbAdd(t)):this.hotWorld&&(this.searchText=this.hotWorld),e.index.hideKeyboard(),this.loadList(this.searchText))},localSearchListManage(s){e.index.getStorageSync(t).length?(this.localSearchList.unshift(s),(e=>{for(let t=e.length-1;t>=0;t--){const s=e.indexOf(e[t]),o=e.lastIndexOf(e[t]);s!=o&&e.splice(o,1)}})(this.localSearchList),this.localSearchList.length>10&&this.localSearchList.pop()):this.localSearchList=[s],e.index.setStorageSync(t,this.localSearchList)},LocalSearchListClear(){e.index.showModal({content:"确认清空搜索历史吗",confirmText:"删除",confirmColor:"red",cancelColor:"#808080",success:s=>{s.confirm&&(this.localSearchListDel=!1,this.localSearchList=[],e.index.removeStorageSync(t))}})},LocalSearchlistItemClick(s,o){if(this.localSearchListDel)return this.localSearchList.splice(o,1),e.index.setStorageSync(t,this.localSearchList),void(this.localSearchList.length||(this.localSearchListDel=!1));this.search(s)},searchHotRefresh(){this.$refs.udb.refresh()},speech(){},searchLogDbAdd(e){this.getDeviceId().then((t=>{this.searchLogDb.add({device_id:t,content:e,create_date:Date.now()})}))},getDeviceId:()=>new Promise(((t,s)=>{const o=e.index.getStorageSync("uni_id");t(o||e.index.getSystemInfoSync().system+"_"+Math.random().toString(36).substr(2))})),associativeClick(e){console.log("associativeClick: ",e),this.loadList(e.title)},loadList(t=""){getApp().globalData.searchText=t,e.index.switchTab({url:"/pages/list/list"})},backPage(){e.index.navigateBack()}},watch:{searchText:(o=function(e){e?this.mallGoodsDb.where({title:new RegExp(e,"gi")}).field("_id,title").get().then((e=>{this.associativeList=e.result.data})):(this.associativeList.length=0,getApp().globalData.searchText="")},i=100,c=o,l=null,n=!0,a&&c(),function(){var e=arguments,t=this;n&&(n=!1,c.apply(t,e)),l&&clearTimeout(l),l=setTimeout((function(){clearTimeout(l),l=null,c.apply(t,e)}),i||200)})}};var o,i,a,c,l,n;if(!Array){(e.resolveComponent("uni-search-bar")+e.resolveComponent("uni-icons")+e.resolveComponent("unicloud-db")+e.resolveComponent("uni-list-item")+e.resolveComponent("uni-list"))()}Math||((()=>"../../../uni_modules/uni-search-bar/components/uni-search-bar/uni-search-bar.js")+(()=>"../../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../../node-modules/@dcloudio/uni-components/lib/unicloud-db/unicloud-db.js")+(()=>"../../../uni_modules/uni-list/components/uni-list-item/uni-list-item.js")+(()=>"../../../uni_modules/uni-list/components/uni-list/uni-list.js"))();const r=e._export_sfc(s,[["render",function(t,s,o,i,a,c){return e.e({a:e.sr("searchBar","fbea3b8f-0"),b:e.o(c.clear),c:e.o(c.confirm),d:e.o(c.cancel),e:e.o((e=>a.searchText=e)),f:e.p({radius:"100",focus:a.focus,placeholder:a.hotWorld,clearButton:"auto",cancelButton:"always",modelValue:a.searchText}),g:a.localSearchList.length},a.localSearchList.length?e.e({h:!a.localSearchListDel},a.localSearchListDel?{k:e.o(((...e)=>c.LocalSearchListClear&&c.LocalSearchListClear(...e))),l:e.o((e=>a.localSearchListDel=!1))}:{i:e.o((e=>a.localSearchListDel=!0)),j:e.p({color:a.iconColor,size:"18",type:"trash"})},{m:e.f(a.localSearchList,((t,s,o)=>e.e({a:e.t(t),b:t},a.localSearchListDel?{c:"fbea3b8f-2-"+o,d:e.p({size:"12",type:"closeempty"})}:{},{e:s,f:e.o((e=>c.LocalSearchlistItemClick(t,s)),s)}))),n:a.localSearchListDel}):{},{o:!a.netHotListIsHide},a.netHotListIsHide?{}:{p:e.o(c.searchHotRefresh),q:e.p({color:a.iconColor,size:"14",type:"reload"})},{r:e.o((e=>a.netHotListIsHide=!a.netHotListIsHide)),s:e.p({color:a.iconColor,size:"18",type:a.netHotListIsHide?"eye-slash":"eye"}),t:e.w((({data:t,loading:s,error:o,options:i},l,n)=>e.e({a:s&&!a.netHotListIsHide},s&&!a.netHotListIsHide?{}:e.e({b:!a.netHotListIsHide},a.netHotListIsHide?{}:e.e({c:o},o?{d:e.t(o.message)}:{e:e.f(t,((t,s,o)=>({a:e.t(t.content),b:s,c:e.o((e=>c.search(t.content)),s)})))})),{f:n,g:l})),{name:"d",path:"t",vueId:"fbea3b8f-5"}),v:e.sr("udb","fbea3b8f-5"),w:e.p({field:"content",collection:"opendb-search-hot",orderby:"create_date desc,count desc","page-data":"replace","page-size":10}),x:c.associativeShow},c.associativeShow?{y:e.f(a.associativeList,((t,s,o)=>({a:t._id,b:e.o((e=>c.associativeClick(t)),t._id),c:"fbea3b8f-7-"+o+",fbea3b8f-6",d:e.p({ellipsis:1,title:t.name,"show-extra-icon":!0,clickable:!0,"extra-icon":{size:18,color:a.iconColor,type:"search"}})})))}:{})}],["__scopeId","data-v-fbea3b8f"]]);wx.createPage(r);
