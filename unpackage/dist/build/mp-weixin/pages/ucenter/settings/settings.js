"use strict";const e=require("../../../common/vendor.js"),t=require("./dc-push/push.js"),n=require("../../../uni_modules/uni-id-pages/common/store.js");require("../../../uni_modules/uni-id-pages/config.js");const i={data:()=>({pushServer:t.pushServer,supportMode:[],pushIsOn:"wait",currentLanguage:"",userInfo:{}}),computed:{hasLogin:()=>n.store.hasLogin,i18nEnable:()=>getApp().globalData.config.i18n.enable},onLoad(){this.currentLanguage="en"==e.index.getStorageSync("CURRENT_LANG")?"English":"简体中文",e.index.setNavigationBarTitle({title:this.$t("settings.navigationBarTitle")}),e.index.checkIsSupportSoterAuthentication({success:e=>{this.supportMode=e.supportMode},fail:e=>{console.log(e)}})},onShow(){},methods:{async changeLoginState(){this.hasLogin?await n.mutations.logout():e.index.redirectTo({url:"/uni_modules/uni-id-pages/pages/login/login-withoutpwd"})},startSoterAuthentication(t){console.log(t);let n={fingerPrint:this.$t("settings.fingerPrint"),facial:this.$t("settings.facial")}[t];this.checkIsSoterEnrolledInDevice({checkAuthMode:t,title:n}).then((()=>{console.log(t,n),e.index.startSoterAuthentication({requestAuthModes:[t],challenge:"123456",authContent:this.$t("settings.please")+` ${n}`,complete:e=>{console.log(e)},success:t=>{if(console.log(t),0==t.errCode)return e.index.showToast({title:`${n}`+this.$t("settings.successText"),icon:"none"});e.index.showToast({title:this.$t("settings.failTip"),icon:"none"})},fail:t=>{console.log(t),console.log(`认证失败:${t.errCode}`),e.index.showToast({title:this.$t("settings.authFailed"),icon:"none"})}})}))},checkIsSoterEnrolledInDevice({checkAuthMode:t,title:n}){return new Promise(((i,o)=>{e.index.checkIsSoterEnrolledInDevice({checkAuthMode:t,success:t=>{if(console.log(t),t.isEnrolled)return i(t);e.index.showToast({title:this.$t("settings.deviceNoOpen")+`${n}`,icon:"none"}),o(t)},fail:t=>{console.log(t),e.index.showToast({title:`${n}`+this.$t("settings.fail"),icon:"none"}),o(t)}})}))},clearTmp(){e.index.showLoading({title:this.$t("settings.clearing"),mask:!0}),e.index.getSavedFileList({success:t=>{t.fileList.length>0?e.index.removeSavedFile({filePath:t.fileList[0].filePath,complete:t=>{console.log(t),e.index.hideLoading(),e.index.showToast({title:this.$t("settings.clearedSuccessed"),icon:"none"})}}):(e.index.hideLoading(),e.index.showToast({title:this.$t("settings.clearedSuccessed"),icon:"none"}))},complete:e=>{console.log(e)}})},changeLanguage(){console.log("语言切换"),e.index.showActionSheet({itemList:["English","简体中文"],success:t=>{console.log(t.tapIndex);let n=e.index.getStorageSync("CURRENT_LANG");if(!t.tapIndex&&"zh-Hans"==n||t.tapIndex&&"en"==n){const i=getApp().globalData;n=i.locale="en"===n?"zh-Hans":"en",e.index.setStorageSync("CURRENT_LANG",n),getApp().globalData.$i18n.locale=n,this.currentLanguage=t.tapIndex?"简体中文":"English",e.index.setLocale&&e.index.setLocale(n),e.index.reLaunch({url:"/pages/list/list",complete:()=>{e.index.$emit("changeLanguage",n)}})}},fail:()=>{},complete:()=>{}})}}};if(!Array){(e.resolveComponent("uni-list-item")+e.resolveComponent("uni-list"))()}Math||((()=>"../../../uni_modules/uni-list/components/uni-list-item/uni-list-item.js")+(()=>"../../../uni_modules/uni-list/components/uni-list/uni-list.js"))();const o=e._export_sfc(i,[["render",function(t,n,i,o,s,l){return e.e({a:e.p({title:t.$t("settings.userInfo"),to:"/uni_modules/uni-id-pages/pages/userinfo/userinfo",link:"navigateTo"}),b:s.userInfo.mobile},s.userInfo.mobile?{c:e.p({title:t.$t("settings.changePassword"),to:"/pages/ucenter/login-page/pwd-retrieve/pwd-retrieve?phoneNumber="+s.userInfo.mobile,link:"navigateTo"})}:{},{d:e.p({border:!1}),e:s.supportMode.includes("fingerPrint")},s.supportMode.includes("fingerPrint")?{f:e.o((e=>l.startSoterAuthentication("fingerPrint"))),g:e.p({title:t.$t("settings.fingerPrint"),link:!0})}:{},{h:s.supportMode.includes("facial")},s.supportMode.includes("facial")?{i:e.o((e=>l.startSoterAuthentication("facial"))),j:e.p({title:t.$t("settings.facial"),link:!0})}:{},{k:l.i18nEnable},l.i18nEnable?{l:e.o(l.changeLanguage),m:e.p({title:t.$t("settings.changeLanguage"),rightText:s.currentLanguage,link:!0})}:{},{n:e.p({border:!1}),o:l.hasLogin},l.hasLogin?{p:e.t(t.$t("settings.logOut"))}:{q:e.t(t.$t("settings.login"))},{r:e.o(((...e)=>l.changeLoginState&&l.changeLoginState(...e)))})}]]);wx.createPage(o);
