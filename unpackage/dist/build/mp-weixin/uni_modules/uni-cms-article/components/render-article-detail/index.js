"use strict";const t=require("../../../../common/vendor.js"),e={name:"render-article-detail",props:{delta:{type:Object,default:{}},adConfig:{type:Object,default:{}}},data:()=>({renderData:[]}),components:{unlockContent:()=>"./unlock-content.js"},mounted(){this.dataPreHandler()},methods:{getRowClass:t=>t?Array.from(t.reduce(((t,e)=>(t.add(e.type),t)),new Set)):[],deltaHandler:t=>[].concat.apply([],t.map((t=>{if("string"!=typeof t.insert)return t;if("\n"===t.insert)return t;const e=t.insert.split("\n");return[].concat.apply([],e.flatMap(((a,i)=>{if(a||i===e.length-1&&!a){const e=[];return i>0&&e.push({insert:"\n",attributes:{}}),e.push({insert:a,attributes:t.attributes}),e}})).filter((t=>t)))}))),dataPreHandler(){const t=[];let e=[],a=null;const i=this.deltaHandler(this.delta.ops);for(const s of i)if("string"==typeof s.insert){if("\n"===s.insert){if(a&&a.data.type!==s.attributes.list&&(t.push({rowItems:[a],rowAttributes:{},rowClass:"",rowStyle:""}),a=null),s.attributes&&s.attributes.list){a||(a={type:"list",data:{type:s.attributes.list,items:[]}}),a.data.items.push(e.length>0?e:[e]),e=[];continue}t.push({rowItems:e,rowAttributes:s.attributes||{},rowClass:this.attributes2class(e,s.attributes,"block"),rowStyle:this.attributes2style(s.attributes,"block")}),e=[];continue}const i=s.insert.split("\n").filter((t=>t));i.length>0&&e.push({type:"text",data:{texts:i,attributes:s.attributes||{},class:this.attributes2class(null,s.attributes,"inline"),style:this.attributes2style(s.attributes,"inline")}})}else s.insert.image?e.push({type:"image",data:{url:s.insert.image,attributes:s.attributes||{},class:this.attributes2class(null,s.attributes,"inline"),style:this.attributes2style(s.attributes,"inline")}}):s.insert.divider?e.push({type:"divider"}):s.insert.unlockContent&&e.push({type:"unlockContent"});a&&t.push({rowItems:[a],rowAttributes:{},rowClass:"",rowStyle:""}),e.length>0&&(t.push({rowItems:e}),e=[]),this.renderData=t},attributes2class(t,e,a){if(!e)return"";const i={inline:["bold","italic","underline","strike","ins","link"],block:["header","list"]}[a];if(!i)throw new Error("type not supported");const s=i.reduce(((t,a)=>e?(!0===e[a]?t.push(a):void 0!==e[a]&&t.push(`${a}-${e[a]}`),t):t),[]);if("link"in e&&s.push("link"),t){const e=this.getRowClass(t);e&&e.length&&s.push(...e)}return s.join(" ")},attributes2style(t,e){if(!t)return"";const a={inline:["align","color","background","font","fontSize","fontStyle","fontVariant","fontWeight","fontFamily","lineHeight","letterSpacing","textDecoration","textIndent","wordWrap","wordBreak","whiteSpace"],block:["align","margin","marginTop","marginBottom","marginLeft","marginRight","padding","paddingTop","paddingBottom","paddingLeft","paddingRight"]}[e],i={align:"text-align"};if(!a)throw new Error("type not supported");return a.reduce(((e,a)=>t?(void 0!==t[a]&&e.push(`${i[a]||a.replace(/([A-Z])/g,((t,e)=>`-${e.toLowerCase()}`))}: ${t[a]}`),e):e),[]).join(";")},goLink(e){e&&t.index.setClipboardData({data:e,success:()=>{t.index.showToast({title:"链接已复制",icon:"none"})}})},imagePreview(e){e&&t.index.previewImage({current:e.split("?")[0],urls:[e.split("?")[0]]})},imageLoad(t){const{idx:e,rowIdx:a}=t.target.dataset,i=this.wxAutoImageCal(t.detail.width,t.detail.height,15),s=this.renderData[a].rowItems[e];(!s.data.attributes.width||s.data.attributes.width>i.imageWidth)&&(this.$set(this.renderData[a].rowItems[e].data.attributes,"width",i.imageWidth),this.$set(this.renderData[a].rowItems[e].data.attributes,"height",i.imageheight))},wxAutoImageCal(e,a,i=0){const s=t.index.getSystemInfoSync();let n=0,r=0,d=0,o={};return n=s.windowWidth-2*i,s.windowHeight,e>n?(r=n,d=r*a/e,o.imageWidth=r,o.imageheight=d):(o.imageWidth=e,o.imageheight=a),o}}};if(!Array){t.resolveComponent("unlock-content")()}const a=t._export_sfc(e,[["render",function(e,a,i,s,n,r){return{a:t.f(n.renderData,((e,a,s)=>({a:t.f(e.rowItems,((e,n,d)=>t.e({a:"text"===e.type},"text"===e.type?t.e({b:e.data.texts.length>1},e.data.texts.length>1?{c:t.f(e.data.texts,((e,a,i)=>({a:t.t(e)}))),d:t.n(e.data.class),e:t.s(e.data.style)}:{f:t.f(e.data.texts,((a,i,s)=>e.data.attributes.link?{a:t.t(a),b:t.n(e.data.class),c:t.s(e.data.style),d:t.o((t=>r.goLink(e.data.attributes.link)))}:{e:t.t(a),f:t.n(e.data.class),g:t.s(e.data.style)})),g:e.data.attributes.link}):"list"===e.type?{i:t.f(e.data.items,((a,i,s)=>t.e("ordered"===e.data.type?{a:t.t(i+1)}:(e.data.type,{}),{b:t.f(a,((e,a,i)=>({a:t.f(e.data.texts,((a,i,s)=>e.data.attributes.link?{a:t.t(a),b:t.n(e.data.class),c:t.s(e.data.style),d:t.o((t=>r.goLink(e.data.attributes.link)))}:{e:t.t(a),f:t.n(e.data.class),g:t.s(e.data.style)})),b:e.data.attributes.link})))}))),j:"ordered"===e.data.type,k:"bullet"===e.data.type,l:t.n(e.data.type)}:"image"===e.type?{n:e.data.url,o:t.n(e.data.class),p:e.data.attributes.alt||"",q:`${e.data.attributes.width}px`,r:`${e.data.attributes.height}px`,s:a,t:n,v:t.o(((...t)=>r.imageLoad&&r.imageLoad(...t))),w:t.o((t=>r.imagePreview(e.data.url)))}:"unlockContent"===e.type?{y:"d8b4447c-0-"+s+"-"+d,z:t.p({"adp-id":i.adConfig.adpId,"watch-ad-unique-type":i.adConfig.watchAdUniqueType})}:(e.type,{}),{h:"list"===e.type,m:"image"===e.type,x:"unlockContent"===e.type,A:"divider"===e.type}))),b:t.n(e.rowClass),c:t.s(e.rowStyle)})))}}],["__scopeId","data-v-d8b4447c"]]);wx.createComponent(a);
