"use strict";const e=require("../../../../common/vendor.js"),t=require("../../common/publish-time.js"),i=e.Ds.database(),n={components:{uniNavBar:()=>"../../../uni-nav-bar/components/uni-nav-bar/uni-nav-bar.js",renderArticleDetail:()=>"../../components/render-article-detail/index.js"},data:()=>({showNavBar:!1,coverImage:{url:"",exists:!0,show:!1,width:1,height:1},id:"",title:"",formData:{},adpId:"",watchAdUniqueType:"device"}),computed:{where(){return`_id =="${this.id}"`},collection(){return[i.collection("uni-cms-articles").where(this.where).field("user_id,thumbnail,excerpt,publish_date,title,content").getTemp(),i.collection("uni-id-users").field("_id, nickname").getTemp()]}},onReady(){this.id?this.$refs.detail.loadData():e.index.showToast({icon:"none",title:"id 不能为空"})},onLoad(t){t.id&&(this.id=t.id),e.index.$on("onUnlockContent",this.onUnlockContent)},onUnload(){e.index.$off("onUnlockContent",this.onUnlockContent)},onPageScroll(e){const t=this.coverImage.height-100>0?this.coverImage.height-100:200;e.scrollTop>t?this.showNavBar=!0:this.showNavBar=!1},methods:{publishTime:e=>t.translatePublishTime(e),back(){const t=getCurrentPages().length,i="/uni_modules/uni-cms-article/pages/list/list";t.length>1?e.index.navigateBack({}):e.index.redirectTo({url:i,fail:t=>{-1!==t.errMsg.indexOf("tabbar")&&e.index.switchTab({url:i})}})},setReadHistory(){const t=(e.index.getStorageSync("readHistory")||[]).filter((e=>e.article_id!==this.id));t.unshift({article_id:this.id,last_time:Date.now()}),e.index.setStorageSync("readHistory",t)},loadData(e){e.thumbnail||(this.coverImage.exists=!1),this.title=e.title,this.setReadHistory()},setCoverImageSize(t){const{width:i,height:n}=t.detail;e.index.getSystemInfo({success:({windowWidth:e})=>{this.coverImage.width=e,this.coverImage.height=e/i*n,this.coverImage.show=!0}})},async onUnlockContent(){this.$refs.detail.loadData()}}};if(!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("uni-nav-bar")+e.resolveComponent("render-article-detail")+e.resolveComponent("unicloud-db"))()}Math||((()=>"../../../uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../../uni-nav-bar/components/uni-nav-bar/uni-nav-bar.js")+(()=>"../../../../node-modules/@dcloudio/uni-components/lib/unicloud-db/unicloud-db.js"))();const o=e._export_sfc(n,[["render",function(t,i,n,o,a,s){return{a:e.w((({data:t,loading:i,error:n,options:o},r,d)=>e.e({a:"09b6998e-2-"+d+",09b6998e-1-"+d,b:"09b6998e-1-"+d+",09b6998e-0",c:t&&t.thumbnail},t&&t.thumbnail?{d:e.n(a.coverImage.show?"show":""),e:t.thumbnail,f:e.o(((...e)=>s.setCoverImageSize&&s.setCoverImageSize(...e))),g:"100%",h:"100%"}:{},{i:!i&&t},!i&&t?e.e({j:e.t(t.title),k:e.t(t.excerpt),l:t.user_id[0]},t.user_id[0]?{m:e.t(t.user_id[0].nickname||"")}:{},{n:e.t(s.publishTime(t.publish_date)),o:"09b6998e-3-"+d+",09b6998e-0",p:e.p({delta:t.content,"ad-config":{adpId:a.adpId,watchAdUniqueType:a.watchAdUniqueType}})}):{q:"09b6998e-4-"+d+",09b6998e-0",r:e.p({type:"spinner-cycle",size:"35px"})},{s:d,t:r})),{name:"d",path:"a",vueId:"09b6998e-0"}),b:e.p({color:a.showNavBar?"#333333":"#ffffff",type:"left",size:"48rpx"}),c:e.o(((...e)=>s.back&&s.back(...e))),d:e.t(a.title),e:e.n(a.showNavBar?"show":""),f:e.p({statusBar:!0,border:!1,rightWidth:"180rpx",backgroundColor:"transparent"}),g:a.coverImage.show?"":1,h:a.coverImage.exists?"":1,i:e.sr("detail","09b6998e-0"),j:e.o(s.loadData),k:e.p({collection:s.collection,options:a.formData,getone:!0,where:s.where,manual:!0,foreignKey:"uni-cms-articles.user_id"})}}],["__scopeId","data-v-09b6998e"]]);n.__runtimeHooks=1,wx.createPage(o);
