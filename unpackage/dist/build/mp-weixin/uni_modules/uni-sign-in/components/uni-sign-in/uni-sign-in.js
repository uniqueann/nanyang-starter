"use strict";const e=require("../../../../common/vendor.js"),n=require("../../utils/ad.js"),s=require("../../../../common/assets.js"),o=e.Ds.database().action("signIn").collection("opendb-sign-in");new Date((new Date).toLocaleDateString()).getTime();const t={name:"uni-signIn",data:()=>({total:0,scores:0,weekdays:[1,2,3,4,5,6,7],signInRes:{days:[],n:0}}),mounted(){},methods:{async getSignedInInfo(n="今日已签过"){const s=new Date((new Date).toLocaleDateString()).getTime();let t=await o.where(`'user_id' == $env.uid && 'date' == ${s} && 'isDelete' == false`).get();return t.result.data.length&&(this.signInRes=t.result,this.$refs.popup.open(),e.index.showToast({title:n,duration:3e3,icon:"none"})),t.result.data},async showRewardedVideoAd(){let s=await this.getSignedInInfo();if(console.log(s),s&&0==s.length){let s=e.Ds.getCurrentUserInfo().uid;if(!s)return e.index.navigateTo({url:"/pages/ucenter/login-page/index/index"});n.AD.show({adpid:1733738477,adType:"RewardedVideo",urlCallback:{userId:s,extra:"uniSignIn"}},(n=>{if(n&&n.isEnded){console.log("onClose "+n.isEnded);let s=0;e.index.showLoading({mask:!0});let o=setInterval((async t=>{s++,n=await this.getSignedInInfo("签到成功"),(s>2||n.length)&&(n.length||e.index.showToast({title:"签到失败！",icon:"error",duration:6e3}),clearInterval(o),e.index.hideLoading())}),2e3)}else console.log("onClose "+n.isEnded),e.index.showToast({title:"播放中途退出,签到失败！",icon:"error",duration:5e3})}),(n=>{console.log(n),e.index.showToast({title:n.errMsg,icon:"none"})}))}},async open(){e.index.showLoading({mask:!0});try{let n=await this.getSignedInInfo();if(n&&0==n.length){let n=await o.add({});console.log(n),e.index.hideLoading(),this.signInRes=n.result,this.$refs.popup.open(),7==this.signInRes.days.length?e.index.showToast({title:"你已完成7日连续签到，获得60积分！",icon:"none",duration:5e3}):e.index.showToast({title:"签到成功,获得10积分！",icon:"none",duration:5e3})}}catch(n){e.index.hideLoading(),console.error(n)}},closeMe(e){this.$refs.popup.close()}}};if(!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../../uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../../uni-popup/components/uni-popup/uni-popup.js"))();const i=e._export_sfc(t,[["render",function(n,o,t,i,a,d){return{a:s._imports_0$1,b:e.t(a.signInRes.days.length),c:e.t(a.signInRes.score),d:e.f(a.weekdays,((n,s,o)=>e.e({a:a.signInRes.days.includes(n-1)},a.signInRes.days.includes(n-1)?{b:"3a740fee-1-"+o+",3a740fee-0",c:e.p({color:"#FFFFFF",type:"checkmarkempty"})}:e.e({d:n<a.signInRes.n},n<a.signInRes.n?{e:"3a740fee-2-"+o+",3a740fee-0",f:e.p({color:"#FFFFFF",type:"closeempty"})}:{g:"3a740fee-3-"+o+",3a740fee-0",h:e.p({type:"checkmarkempty",color:"#FFFFFF"})}),{i:a.signInRes.days.includes(n-1)||n>a.signInRes.n},a.signInRes.days.includes(n-1)||n>a.signInRes.n?{j:e.t(n),k:n>a.signInRes.n?1:""}:{},{l:s}))),e:e.o(d.closeMe),f:e.p({type:"closeempty",size:"20",color:"#AAAAAA"}),g:e.sr("popup","3a740fee-0"),h:e.p({type:"center"})}}]]);wx.createComponent(i);
